<ion-view title="Nearby Stops & Routes">
    <ion-nav-buttons side="right">
        <button class="button button-clear" ng-click="refresh()">
            <i class="icon ion-refresh"></i>
        </button>

    </ion-nav-buttons>

    <ion-content ng-show="data.loaded" has-bouncing="true">

		<div data-tap-disabled="true">
    	<leaflet center="center" markers="markers" defaults="defaults" paths="paths" height="200px"></leaflet>
		</div>
		

  
 					 <!--
        <ion-list>
            <ion-item ng-repeat="item in data.stops | orderBy:'dist'" href="#/tab/atstop/{{item.id}}/{{item.name | encodeStopName}}">
                {{item.name}}
                <p class="routesAtStop">
                    Routes:<span ng-repeat="r in item.routes"> {{r.shortName}} </span>
                </p>
            </ion-item>
        </ion-list>
						 -->
						
		        <ion-list>
		            <ion-item ng-repeat="item in data.stops | orderBy:'dist'">
		                {{item.name}}
		                <p class="routesAtStop">
		                   Routes: <span ng-repeat="r in item.routes"> <a href="" ng-click="showOnMap('route', r.id);showOnMap('stop', item.id, item.lat, item.lon, item.name);">{{r.shortName}}</a></span>
		                </p>
										
		                <button class="button button-positive button-small button-clear" ng-click="modal.show();getBuses(item.id);">
		                    See more
		                </button>
		            </ion-item>
		        </ion-list>

        <!-- Optional / Since every stop display routes passing it-->
        <!--
				<ion-list>
            <ion-item ng-repeat="item in data.routes |limitTo:10">
                {{item.shortName}}
                <button class="button button-positive button-small button-clear" ng-click="showOnMap('route', item.id)">
                    Map
                </button>
                <a class="button button-positive button-small button-clear" href="#/tab/route/{{item.id}}/{{item.shortName}}">Stops</a>
            </ion-item>
        </ion-list>
				-->
				

        <p>{{data.notifications}}</p>
    </ion-content>
		
    <script id="templates/modal.html" type="text/ng-template">
      <ion-modal-view>
        <ion-header-bar class="bar bar-header bar-positive">
          <h1 class="title">Upcoming Buses</h1>
          <button class="button button-clear button-primary" ng-click="modal.hide()">Close</button>
        </ion-header-bar>
        <ion-content class="padding">
        <div bindonce ng-repeat="(routeId, info) in data.results" class=" ">
            <div class="row item item-divider">
                <div class="route col vcenter"><a href="#/tab/route/{{routeId}}/{{info.name}}">{{info.name}}</a></div>
            </div>
            <ion-list>
                <ion-item bindonce ng-repeat="item in info.distances">
                    <h2>{{item.destination}}</h2>
										{{item.distance}}
                </ion-item>
            </ion-list>
        </div>
        </ion-content>
      </ion-modal-view>
    </script>
</ion-view>
